{"ast":null,"code":"import _regeneratorRuntime from\"/Users/karthik/dev/milkyway/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/karthik/dev/milkyway/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/karthik/dev/milkyway/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/karthik/dev/milkyway/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/Users/karthik/dev/milkyway/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/karthik/dev/milkyway/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/karthik/dev/milkyway/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import{Button,Container,Row,Col,Card,Spinner}from'react-bootstrap';import AppContext from'../AppContext';import'../App.css';import img from'../noImage.png';import Quagga from'@ericblade/quagga2';var IMAGE_WIDTH=\"100%\";var IMAGE_HEIGHT=\"100%\";var FileScan=/*#__PURE__*/function(_React$Component){_inherits(FileScan,_React$Component);var _super=_createSuper(FileScan);function FileScan(props){var _this;_classCallCheck(this,FileScan);_this=_super.call(this,props);_this.state={};_this.triggerInputFile=_this.triggerInputFile.bind(_assertThisInitialized(_this));return _this;}_createClass(FileScan,[{key:\"highlightBarcode\",value:function highlightBarcode(result){console.log('barcode',result);var _result$box=result.box,box=_result$box===void 0?[]:_result$box;var imgEl=document.getElementById(\"uploaded-image\");var cnvs=document.getElementById(\"my-canvas\");cnvs.style.position=\"absolute\";cnvs.style.left=imgEl.offsetLeft+\"px\";cnvs.style.top=imgEl.offsetTop+\"px\";var ctx=cnvs.getContext(\"2d\");ctx.beginPath();var line=box[0];ctx.moveTo(line[0],line[1]);line=box[1];ctx.lineTo(line[0],line[1]);ctx.stroke();ctx.moveTo(line[0],line[1]);line=box[2];ctx.lineTo(line[0],line[1]);ctx.stroke();ctx.moveTo(line[0],line[1]);line=box[3];ctx.lineTo(line[0],line[1]);ctx.stroke();ctx.moveTo(line[0],line[1]);line=box[0];ctx.lineTo(line[0],line[1]);ctx.stroke();ctx.lineWidth=3;ctx.strokeStyle='#ff0000';ctx.stroke();}},{key:\"imageToDataUri\",value:function imageToDataUri(imgResize,width,height){// create an off-screen canvas\nvar canvas=document.createElement('canvas'),ctx=canvas.getContext('2d');// set its dimension to target size\ncanvas.width=width;canvas.height=height;// draw source image into the off-screen canvas:\nctx.drawImage(imgResize,0,0,width,height);// encode image to data-uri with base64 version of compressed image\nreturn canvas.toDataURL('image/jpeg',1.0);}},{key:\"handleChange\",value:function(){var _handleChange=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){var files,file,fileData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:files=event.target.files;file=files[0];_context.next=4;return this.toBase64(file);case 4:fileData=_context.sent;// var imgUploaded = new Image();\n// imgUploaded.src = fileData;\n// const newDataUri = await this.resizedataURL(imgUploaded, IMAGE_WIDTH, IMAGE_HEIGHT);\n// console.log('ad', imgUploaded, newDataUri)\nthis.setState({uploadedImage:fileData,isLoading:true},function(){// const imgEl = document.getElementById(\"uploaded-image\");\n// const desiredWidth = imgEl.width\n// const desiredHeight = imgEl.height\n// const resizeImage = this.imageToDataUri(imgEl, desiredWidth, desiredHeight)\n// this.scanFileForBarcode(resizeImage)\n});this.scanFileForBarcode(fileData);case 7:case\"end\":return _context.stop();}}},_callee,this);}));function handleChange(_x){return _handleChange.apply(this,arguments);}return handleChange;}()},{key:\"triggerInputFile\",value:function triggerInputFile(){this.fileInput.click();}},{key:\"addToHistory\",value:function addToHistory(barcodeObj){var _this$context$history=this.context.history,history=_this$context$history===void 0?[]:_this$context$history;history.push(barcodeObj);this.context.setVal({key:'history',value:history});}},{key:\"scanFileForBarcode\",value:function scanFileForBarcode(fileData){var self=this;Quagga.decodeSingle({decoder:{readers:[\"code_128_reader\",\"ean_5_reader\",\"upc_reader\",\"ean_reader\",\"ean_8_reader\",\"ean_2_reader\",\"code_39_reader\",\"code_93_reader\"]// List of active readers\n},locate:true,// try to locate the barcode in the image\nsize:536,src:fileData// or 'data:image/jpg;base64,' + data\n},function(result){if(result.codeResult){self.addToHistory({img:fileData,barcode:result.codeResult.code,barcodeType:result.codeResult.format,time:new Date()});self.highlightBarcode(result);self.setState({barcodeDetected:result.codeResult.code,barcodeType:result.codeResult.format,isLoading:false});}else{self.addToHistory({img:fileData,barcode:\"Not Detected\",time:new Date()});self.setState({isLoading:false});}});}},{key:\"toBase64\",value:function toBase64(file){return new Promise(function(resolve,reject){var reader=new FileReader();reader.readAsDataURL(file);reader.onload=function(){return resolve(reader.result);};reader.onerror=function(error){return reject(error);};});}},{key:\"render\",value:function render(){var _this2=this;var _this$state=this.state,_this$state$barcodeDe=_this$state.barcodeDetected,barcodeDetected=_this$state$barcodeDe===void 0?'No Barcode Detected!!':_this$state$barcodeDe,uploadedImage=_this$state.uploadedImage,_this$state$isLoading=_this$state.isLoading,isLoading=_this$state$isLoading===void 0?false:_this$state$isLoading,barcodeType=_this$state.barcodeType;return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Container,{style:{marginTop:\"50px\"}},/*#__PURE__*/React.createElement(Row,{lg:6},/*#__PURE__*/React.createElement(Col,{style:{border:'2px solid #000000'},lg:6},uploadedImage?/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"img\",{id:\"uploaded-image\",alt:\"barcode-image\",src:uploadedImage,height:IMAGE_HEIGHT,width:IMAGE_WIDTH}),/*#__PURE__*/React.createElement(\"canvas\",{id:\"my-canvas\",height:\"1000px\",width:\"1000px\"})):/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"img\",{src:img,alt:\"upload something\",height:\"400\"})),\"Upload a image to scan barcode\")),/*#__PURE__*/React.createElement(Col,{lg:\"6\"},/*#__PURE__*/React.createElement(Row,{style:{marginTop:\"15px\",marginLeft:\"0\",marginRight:\"auto\"}},/*#__PURE__*/React.createElement(Card,{className:\"text-center\",border:\"secondary\",style:{width:'100%'}},/*#__PURE__*/React.createElement(\"input\",{ref:function ref(fileInput){return _this2.fileInput=fileInput;},type:\"file\",onChange:this.handleChange.bind(this),style:{display:\"none\"},accept:\"image/jpeg\"}),/*#__PURE__*/React.createElement(Card.Body,{style:{width:'100%',height:\"130px\"}},/*#__PURE__*/React.createElement(Button,{onClick:this.triggerInputFile},\" Upload File \"),/*#__PURE__*/React.createElement(\"p\",null,\"Upload any JPEG image with barcode\")))),/*#__PURE__*/React.createElement(Row,{style:{marginTop:\"15px\",marginLeft:\"0\",marginRight:\"auto\"}},/*#__PURE__*/React.createElement(Card,{className:\"text-center\",border:\"secondary\",style:{width:'100%'}},/*#__PURE__*/React.createElement(Card.Header,null,\"Barcode Detected:\"),/*#__PURE__*/React.createElement(Card.Body,{style:{width:'100%',height:\"130px\"}},isLoading?/*#__PURE__*/React.createElement(Spinner,{animation:\"border\"}):/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"p\",null,\"Barcode: \",barcodeDetected),barcodeType?/*#__PURE__*/React.createElement(\"p\",null,\"Barcode Type: \",barcodeType):/*#__PURE__*/React.createElement(\"p\",null)))))))));}}]);return FileScan;}(React.Component);FileScan.contextType=AppContext;export default FileScan;","map":{"version":3,"sources":["/Users/karthik/dev/milkyway/src/Components/FileScan.js"],"names":["React","Button","Container","Row","Col","Card","Spinner","AppContext","img","Quagga","IMAGE_WIDTH","IMAGE_HEIGHT","FileScan","props","state","triggerInputFile","bind","result","console","log","box","imgEl","document","getElementById","cnvs","style","position","left","offsetLeft","top","offsetTop","ctx","getContext","beginPath","line","moveTo","lineTo","stroke","lineWidth","strokeStyle","imgResize","width","height","canvas","createElement","drawImage","toDataURL","event","files","target","file","toBase64","fileData","setState","uploadedImage","isLoading","scanFileForBarcode","fileInput","click","barcodeObj","context","history","push","setVal","key","value","self","decodeSingle","decoder","readers","locate","size","src","codeResult","addToHistory","barcode","code","barcodeType","format","time","Date","highlightBarcode","barcodeDetected","Promise","resolve","reject","reader","FileReader","readAsDataURL","onload","onerror","error","marginTop","border","marginLeft","marginRight","handleChange","display","Component","contextType"],"mappings":"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","sourcesContent":["import React from 'react';\nimport {  Button, Container, Row, Col, Card, Spinner } from 'react-bootstrap'\nimport AppContext from '../AppContext';\nimport '../App.css'\nimport img from '../noImage.png'\nimport Quagga from '@ericblade/quagga2';\nconst IMAGE_WIDTH = \"100%\";\nconst IMAGE_HEIGHT = \"100%\";\nclass FileScan extends React.Component {\n    constructor(props){\n        super(props)\n        this.state={\n        }\n        this.triggerInputFile = this.triggerInputFile.bind(this)\n    }\n\n    highlightBarcode(result) {\n        console.log('barcode', result)\n        const { box = [] } = result;\n        const imgEl = document.getElementById(\"uploaded-image\");\n        const cnvs = document.getElementById(\"my-canvas\");\n\n        cnvs.style.position = \"absolute\";\n        cnvs.style.left = imgEl.offsetLeft + \"px\";\n        cnvs.style.top = imgEl.offsetTop + \"px\";\n\n        const ctx = cnvs.getContext(\"2d\");\n        ctx.beginPath();\n\n        let line = box[0];\n        ctx.moveTo(line[0], line[1]);\n\n        line = box[1];\n        ctx.lineTo(line[0], line[1]);\n        ctx.stroke();\n        ctx.moveTo(line[0], line[1]);\n\n        line = box[2];\n        ctx.lineTo(line[0], line[1]);\n        ctx.stroke();\n        ctx.moveTo(line[0], line[1]);\n\n        line = box[3];\n        ctx.lineTo(line[0], line[1]);\n        ctx.stroke();\n        ctx.moveTo(line[0], line[1]);\n\n        line = box[0];\n        ctx.lineTo(line[0], line[1]);\n        ctx.stroke();\n\n        ctx.lineWidth = 3;\n        ctx.strokeStyle = '#ff0000';\n        ctx.stroke();\n    }\n\n    imageToDataUri(imgResize, width, height) {\n\n        // create an off-screen canvas\n        var canvas = document.createElement('canvas'),\n            ctx = canvas.getContext('2d');\n    \n        // set its dimension to target size\n        canvas.width = width;\n        canvas.height = height;\n    \n        // draw source image into the off-screen canvas:\n        ctx.drawImage(imgResize, 0, 0, width, height);\n    \n        // encode image to data-uri with base64 version of compressed image\n        return canvas.toDataURL('image/jpeg', 1.0)\n    }\n\n    async handleChange(event){\n        const files = event.target.files;\n        const file = files[0];\n        let fileData = await this.toBase64(file);\n        // var imgUploaded = new Image();\n        // imgUploaded.src = fileData;\n        // const newDataUri = await this.resizedataURL(imgUploaded, IMAGE_WIDTH, IMAGE_HEIGHT);\n        // console.log('ad', imgUploaded, newDataUri)\n       \n        this.setState({\n            uploadedImage: fileData,\n            isLoading: true\n        }, () => {\n            // const imgEl = document.getElementById(\"uploaded-image\");\n            // const desiredWidth = imgEl.width\n            // const desiredHeight = imgEl.height\n            // const resizeImage = this.imageToDataUri(imgEl, desiredWidth, desiredHeight)\n            // this.scanFileForBarcode(resizeImage)\n        })\n        this.scanFileForBarcode(fileData)\n       \n    }\n    triggerInputFile() { \n        this.fileInput.click() \n    }\n    addToHistory(barcodeObj){\n        const { history = [] } = this.context;\n        history.push(barcodeObj)\n        this.context.setVal({ key: 'history', value: history })\n    }\n    scanFileForBarcode(fileData){\n        const self = this;\n        Quagga.decodeSingle({\n            decoder: {\n                readers: [\"code_128_reader\", \"ean_5_reader\",\"upc_reader\",\"ean_reader\",\"ean_8_reader\", \"ean_2_reader\", \"code_39_reader\", \"code_93_reader\"] // List of active readers\n            },\n            locate: true, // try to locate the barcode in the image\n            size: 536,\n            src: fileData // or 'data:image/jpg;base64,' + data\n        }, function(result){\n            if(result.codeResult) {\n                self.addToHistory({\n                    img:fileData,\n                    barcode:result.codeResult.code,\n                    barcodeType: result.codeResult.format,\n                    time: new Date()\n                })\n                self.highlightBarcode(result)\n                self.setState({\n                    barcodeDetected: result.codeResult.code,\n                    barcodeType: result.codeResult.format,\n                    isLoading:false\n                })\n                \n            } else {\n                self.addToHistory({\n                    img:fileData,\n                    barcode:\"Not Detected\",\n                    time: new Date()\n                })\n                self.setState({\n                    isLoading:false \n                })\n            }\n        });\n    }\n    toBase64(file) {\n        return new Promise((resolve, reject) => {\n            const reader = new FileReader();\n            reader.readAsDataURL(file);\n            reader.onload = () => resolve(reader.result);\n            reader.onerror = error => reject(error);\n        })\n    }\n    render(){\n        const { barcodeDetected = 'No Barcode Detected!!', uploadedImage, isLoading = false, barcodeType } = this.state;\n        return (\n            <div>\n                <Container style={{marginTop:\"50px\"}}>\n                    <Row lg={6}>\n                        <Col style={{\n                            border: '2px solid #000000'\n                        }} lg={6}>\n                            {uploadedImage?<div><img \n                            id='uploaded-image'\n                            alt='barcode-image'\n                            src={uploadedImage} height={IMAGE_HEIGHT} width={IMAGE_WIDTH}\n                            >\n                            </img>\n                                <canvas id='my-canvas' height={\"1000px\"}\n                                    width={\"1000px\"}></canvas>\n                            </div>\n                            :\n                            <div>\n                            <div>\n                            <img \n                            src={img}\n                            alt='upload something'\n                            height=\"400\"\n                            >\n                                \n                            </img>\n                            </div>\n                            Upload a image to scan barcode\n                            </div>\n                            }\n                            \n                        </Col>\n                        <Col lg={\"6\"}>\n                            <Row style={{ marginTop: \"15px\", marginLeft: \"0\", marginRight: \"auto\" }}>\n                                <Card className=\"text-center\" border=\"secondary\" style={{ width: '100%', }}>\n                                    <input\n                                        ref={fileInput => this.fileInput = fileInput}\n                                        type=\"file\"\n                                        onChange={this.handleChange.bind(this)}\n                                        style={{ display: \"none\" }}\n                                        accept=\"image/jpeg\"\n                                    />\n                                    <Card.Body style={{ width: '100%', height: \"130px\" }}>\n                                        <Button onClick={this.triggerInputFile}> Upload File </Button>\n                                        <p>Upload any JPEG image with barcode</p>\n                                    </Card.Body>\n\n\n                                </Card>\n\n                            </Row>\n                            <Row style={{ marginTop: \"15px\", marginLeft: \"0\", marginRight: \"auto\" }}>\n                                <Card className=\"text-center\" border=\"secondary\" style={{ width: '100%', }}>\n                                    <Card.Header >\n                                        \n                                        Barcode Detected:\n                                    </Card.Header>\n                                    <Card.Body style={{ width: '100%', height: \"130px\" }}>\n                                    {isLoading?<Spinner animation=\"border\" />:\n                                    <div><p>Barcode: {barcodeDetected}</p>\n                                    {barcodeType?<p>Barcode Type: {barcodeType}</p>:<p/>}</div>}\n                                    </Card.Body>\n                                </Card>\n\n                            </Row>\n\n                        </Col>\n                    </Row>\n                </Container>\n\n            </div>\n\n        )\n    }\n    \n\n\n}\nFileScan.contextType = AppContext;\nexport default FileScan;"]},"metadata":{},"sourceType":"module"}